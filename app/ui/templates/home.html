{% extends "base.html" %}

{% block content %}
<section class="mx-auto grid w-full max-w-6xl gap-8 lg:grid-cols-[minmax(0,_700px)_minmax(0,_360px)] lg:items-start lg:justify-center">
    <div class="flex w-full max-w-2xl flex-col gap-8 justify-self-center lg:justify-self-start">
        <section class="card-surface rounded-3xl bg-slate-900/80 p-6 shadow-xl shadow-black/20">
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div>
                    <h2 class="text-lg font-semibold text-white">Stories</h2>
                    <p class="text-sm text-slate-400">Share bite-sized updates that disappear after a day.</p>
                </div>
                <button
                    id="story-create-button"
                    type="button"
                    class="mobile-tap-target inline-flex w-full items-center justify-center gap-2 rounded-full border border-indigo-400/70 bg-indigo-500/20 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-indigo-100 transition hover:border-indigo-300 sm:w-auto"
                >
                    <span class="text-base">＋</span><span>New story</span>
                </button>
            </div>
            <div class="mt-6">
                <div id="story-rail" class="flex items-stretch gap-4 overflow-x-auto pb-3 snap-x snap-mandatory">
                    <button
                        id="story-self-pill"
                        type="button"
                        class="mobile-tap-target group flex w-28 flex-col items-center gap-2 rounded-2xl border border-dashed border-slate-700/70 bg-slate-900/40 p-3 text-xs text-slate-400 transition hover:border-indigo-500/70 hover:text-indigo-200"
                    >
                        <span class="flex h-16 w-16 items-center justify-center rounded-full border border-slate-700/60 bg-slate-800/80 text-2xl text-indigo-300">＋</span>
                        <span class="font-semibold text-slate-200">Your story</span>
                        <span data-story-self-status class="text-[10px] uppercase tracking-[0.2em] text-slate-500">Tap to add</span>
                    </button>
                    <div id="story-rail-items" class="flex gap-4"></div>
                </div>
                <div id="story-empty" class="mt-6 hidden rounded-2xl border border-dashed border-slate-700/70 bg-slate-900/40 px-4 py-6 text-center text-sm text-slate-400">
                    Stories from people you follow will show up here.
                </div>
                <div id="story-loading" class="mt-4 hidden">{{ components.feedback.loading_spinner(label="Loading stories") | safe }}</div>
            </div>
        </section>
        <section class="card-surface rounded-3xl bg-slate-900/80 p-6 shadow-xl shadow-black/20">
            <header class="flex items-center justify-between">
                <div>
                    <h1 class="text-lg font-semibold text-white">Share something new</h1>
                    <p class="text-sm text-slate-400">Post updates, media, or shout-outs to your community.</p>
                </div>
                <span class="hidden rounded-full bg-indigo-500/20 px-3 py-1 text-xs font-medium text-indigo-300 md:inline-flex">Realtime</span>
            </header>
            <form id="composer-form" class="mt-6 flex flex-col gap-4" enctype="multipart/form-data">
                {{ components.forms.textarea("caption", label="What's happening?", placeholder="Share an update, celebrate a win, or drop a hot take…", rows=4, required=True) | safe }}
                <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
                    <div class="flex flex-col gap-3 md:flex-row md:items-center md:gap-4">
                        {{ components.forms.file_input("file", label="Attach media") | safe }}
                        <div id="media-preview" class="hidden overflow-hidden rounded-2xl border border-slate-700/70 bg-slate-900/70">
                            <img id="media-preview-image" class="hidden h-24 w-24 object-cover" alt="Preview" />
                            <video id="media-preview-video" class="hidden h-24 w-24 object-cover" controls muted playsinline></video>
                        </div>
                    </div>
                    <button
                        id="post-submit"
                        type="submit"
                        class="mobile-tap-target inline-flex w-full items-center justify-center gap-2 rounded-full bg-indigo-600 px-5 py-2 text-sm font-semibold text-white shadow-lg shadow-indigo-500/30 transition hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 md:w-auto"
                    >
                        <span class="text-base">✎</span><span>Publish</span>
                    </button>
                </div>
            </form>
        </section>

        <section class="card-surface rounded-3xl bg-slate-900/70 p-6 shadow-xl shadow-black/20">
            <div class="flex items-center justify-between">
                <h2 class="text-lg font-semibold text-white">Your feed</h2>
                <span id="feed-count" class="rounded-full bg-slate-800/80 px-3 py-1 text-xs text-slate-400">0 posts</span>
            </div>
            <div id="feed-loading" class="mt-6">{{ components.feedback.loading_spinner(label="Fetching posts") | safe }}</div>
            <div id="feed-empty" class="mt-6 hidden rounded-2xl border border-dashed border-slate-700/70 bg-slate-900/50 p-10 text-center text-sm text-slate-400">
                No posts yet. Be the first to kick off the conversation!
            </div>
            <div id="feed-list" class="mt-6 grid gap-6"></div>
            <div class="mt-8 flex justify-center">
                <button id="feed-load-more" class="hidden rounded-full border border-slate-700/70 px-6 py-2 text-sm text-slate-300 transition hover:border-indigo-500 hover:text-indigo-200">Load more</button>
            </div>
        </section>
    </div>
    <aside class="flex w-full max-w-sm flex-col gap-6 justify-self-center lg:justify-self-start">
        <section class="card-surface rounded-3xl bg-slate-900/70 p-6 shadow-xl shadow-black/20">
            <h2 class="text-base font-semibold text-white">Trending tags</h2>
            <ul id="trends" class="mt-4 space-y-3 text-sm text-indigo-300">
                <li class="flex items-center justify-between"><span>#fastapi</span><span class="text-slate-500">12.4K</span></li>
                <li class="flex items-center justify-between"><span>#buildinpublic</span><span class="text-slate-500">8.8K</span></li>
                <li class="flex items-center justify-between"><span>#tailwind</span><span class="text-slate-500">5.6K</span></li>
            </ul>
        </section>
        <section class="card-surface rounded-3xl bg-slate-900/70 p-6 shadow-xl shadow-black/20">
            <div class="flex items-center justify-between">
                <h2 class="text-base font-semibold text-white">Media drafts</h2>
                <a href="/media" class="text-xs font-medium text-indigo-300 hover:text-indigo-200">Manage</a>
            </div>
            <div id="media-drafts" class="mt-4 flex h-24 items-center justify-center rounded-2xl border border-dashed border-slate-700/70 text-sm text-slate-500">
                Upload new media to see a preview here.
            </div>
        </section>
        <section class="card-surface rounded-3xl bg-slate-900/70 p-6 shadow-xl shadow-black/20">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-base font-semibold text-white">Social AI companion</h2>
                    <p class="text-sm text-slate-400">Chat with your on-platform assistant for ideas and guidance.</p>
                </div>
                <span class="rounded-full border border-fuchsia-500/30 bg-fuchsia-500/10 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-fuchsia-200">Beta</span>
            </div>
            <div id="ai-chat-container" class="mt-4 flex flex-col gap-4">
                <div id="ai-chat-log" class="scrollbar-thin h-64 space-y-3 overflow-y-auto rounded-2xl border border-slate-800/60 bg-slate-950/60 p-4">
                    <p class="text-xs text-slate-500">Conversations reset when you refresh the page.</p>
                </div>
                <div id="ai-chat-controls" class="flex flex-col gap-3 text-sm">
                    <label class="flex flex-col gap-1 text-xs font-semibold uppercase tracking-[0.25em] text-slate-400">
                        Tone
                        <select id="ai-mode-select" class="rounded-2xl border border-slate-700/70 bg-slate-900/60 px-3 py-2 text-sm text-slate-100 focus:border-fuchsia-400 focus:outline-none">
                            <option value="default">Default</option>
                            <option value="freaky">Freaky</option>
                            <option value="deep">Deep</option>
                        </select>
                    </label>
                    <label class="inline-flex items-center gap-2 text-xs text-slate-400">
                        <input type="checkbox" id="ai-confirm-adult" class="h-4 w-4 rounded border-slate-700/70 bg-transparent" />
                        I am 18+ and consent to optional adult content
                    </label>
                </div>
                <div id="ai-chat-input-row" class="flex flex-col gap-2 sm:flex-row">
                    <input
                        id="ai-chat-input"
                        type="text"
                        placeholder="Ask Social AI something..."
                        class="flex-1 rounded-2xl border border-slate-700/70 bg-slate-900/60 px-4 py-2 text-sm text-slate-100 placeholder:text-slate-500 focus:border-fuchsia-400 focus:outline-none"
                    />
                    <button
                        id="ai-chat-send"
                        type="button"
                        class="mobile-tap-target rounded-2xl bg-fuchsia-600 px-5 py-2 text-sm font-semibold text-white shadow-lg shadow-fuchsia-500/30 transition hover:bg-fuchsia-500"
                    >
                        Send
                    </button>
                </div>
            </div>
        </section>
    </aside>
</section>
<div id="story-modal" class="fixed inset-0 z-50 hidden items-start justify-center overflow-y-auto bg-black/70 px-4 py-10 md:items-center">
    <div class="relative w-full max-w-4xl rounded-[32px] bg-slate-950/95 p-6 shadow-2xl shadow-black/50">
        <header class="flex items-start justify-between gap-4">
            <div>
                <p class="text-xs uppercase tracking-[0.3em] text-slate-500">Stories</p>
                <h3 class="text-2xl font-semibold text-white">Create a new moment</h3>
            </div>
            <button type="button" class="mobile-tap-target rounded-full border border-slate-800/70 px-4 py-2 text-sm text-slate-300 transition hover:border-rose-500/80 hover:text-white" data-story-close>Close</button>
        </header>
        <form id="story-form" class="mt-6 grid gap-6 lg:grid-cols-[minmax(0,_320px)_minmax(0,_1fr)]">
            <div>
                <div id="story-preview" class="relative aspect-[3/4] overflow-hidden rounded-3xl border border-slate-800/80 bg-slate-900">
                    <img id="story-preview-image" class="absolute inset-0 hidden h-full w-full object-cover" alt="Story preview image" />
                    <video id="story-preview-video" class="absolute inset-0 hidden h-full w-full object-cover" muted loop playsinline></video>
                    <div id="story-preview-overlay" class="pointer-events-none absolute inset-x-4 bottom-4 inline-flex max-w-[85%] rounded-3xl px-4 py-3 text-base font-semibold text-white">
                        Add a quick note…
                    </div>
                </div>
                <p class="mt-3 text-xs text-slate-500">Vertical photos or short MP4 clips look best. We keep each story visible for 24 hours.</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="text-sm font-semibold text-white">Media file</label>
                    <input id="story-file-input" type="file" accept="image/*,video/*" class="mt-2 w-full rounded-2xl border border-slate-700/70 bg-transparent px-4 py-2 text-sm text-slate-100 focus:border-indigo-400 focus:outline-none" required />
                </div>
                <div>
                    <label class="text-sm font-semibold text-white">Overlay text</label>
                    <textarea id="story-text-input" rows="3" placeholder="Add a short caption" class="mt-2 w-full rounded-2xl border border-slate-700/70 bg-transparent px-4 py-3 text-sm text-slate-100 focus:border-indigo-400 focus:outline-none"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">Text color</label>
                        <input id="story-text-color" type="color" value="#f8fafc" class="mt-2 h-12 w-full cursor-pointer rounded-2xl border border-slate-700/70 bg-slate-900" />
                    </div>
                    <div>
                        <label class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">Background color</label>
                        <input id="story-text-background" type="color" value="#0f172a" class="mt-2 h-12 w-full cursor-pointer rounded-2xl border border-slate-700/70 bg-slate-900" />
                    </div>
                </div>
                    <div>
                    <label class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">Background style</label>
                    <div class="mt-2 grid grid-cols-2 gap-2 sm:grid-cols-4">
                        <button type="button" data-story-bg="clear" class="story-bg-preset rounded-2xl border border-slate-700/70 px-3 py-2 text-xs text-slate-200 transition hover:border-indigo-400">No fill</button>
                        <button type="button" data-story-bg="solid" class="story-bg-preset rounded-2xl border border-slate-700/70 px-3 py-2 text-xs text-slate-200 transition hover:border-indigo-400">Solid</button>
                        <button type="button" data-story-bg="sunset" class="story-bg-preset rounded-2xl border border-slate-700/70 px-3 py-2 text-xs text-slate-200 transition hover:border-indigo-400">Sunset</button>
                        <button type="button" data-story-bg="aurora" class="story-bg-preset rounded-2xl border border-slate-700/70 px-3 py-2 text-xs text-slate-200 transition hover:border-indigo-400">Aurora</button>
                    </div>
                </div>
                <div>
                    <label class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">Placement</label>
                    <div class="mt-2 grid grid-cols-3 gap-2 text-xs">
                        <button type="button" data-story-position="top-left" class="rounded-2xl border border-slate-700/70 px-3 py-2 text-slate-200">Top left</button>
                        <button type="button" data-story-position="top-right" class="rounded-2xl border border-slate-700/70 px-3 py-2 text-slate-200">Top right</button>
                        <button type="button" data-story-position="center" class="rounded-2xl border border-slate-700/70 px-3 py-2 text-slate-200">Center</button>
                        <button type="button" data-story-position="bottom-left" class="rounded-2xl border border-slate-700/70 px-3 py-2 text-slate-200">Bottom left</button>
                        <button type="button" data-story-position="bottom-right" class="rounded-2xl border border-slate-700/70 px-3 py-2 text-slate-200">Bottom right</button>
                    </div>
                </div>
                <div>
                    <label class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">Font size</label>
                    <input id="story-font-size" type="range" min="16" max="40" value="22" class="mt-2 w-full accent-indigo-500" />
                    <p class="mt-1 text-right text-xs text-slate-500"><span id="story-font-size-label">22px</span></p>
                </div>
                <div id="story-modal-feedback" class="hidden text-sm text-rose-300"></div>
                <div class="flex items-center justify-end gap-3 pt-2">
                    <button type="button" class="mobile-tap-target rounded-full border border-slate-700/70 px-4 py-2 text-sm text-slate-300 transition hover:border-slate-500" data-story-close>Cancel</button>
                    <button id="story-form-submit" type="submit" class="mobile-tap-target inline-flex items-center gap-2 rounded-full bg-indigo-600 px-6 py-2 text-sm font-semibold text-white shadow-lg shadow-indigo-500/30 transition hover:bg-indigo-500">
                        <span>Share story</span>
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<div id="story-viewer" class="fixed inset-0 z-40 hidden items-start justify-center overflow-y-auto bg-black/80 px-4 py-10 md:items-center">
    <div class="relative w-full max-w-3xl rounded-[32px] bg-slate-950/90 p-6 shadow-2xl shadow-black/60">
        <button type="button" class="mobile-tap-target absolute right-6 top-6 rounded-full border border-slate-700/70 px-3 py-1 text-xs uppercase tracking-[0.2em] text-slate-300 hover:border-rose-500/80 hover:text-white" data-story-viewer-close>Close</button>
        <div class="relative overflow-hidden rounded-[28px] border border-slate-800/70">
            <img id="story-viewer-image" class="hidden h-[520px] w-full object-cover" alt="Story image" />
            <video id="story-viewer-video" class="hidden h-[520px] w-full object-cover" muted playsinline controls></video>
            <div class="pointer-events-none absolute inset-0 p-6">
                <div id="story-viewer-text" class="hidden max-w-sm rounded-3xl px-4 py-3 text-lg font-semibold text-white"></div>
            </div>
        </div>
        <div class="mt-5 flex flex-wrap items-center justify-between gap-4">
            <div>
                <p id="story-viewer-author" class="text-sm font-semibold text-white"></p>
                <p id="story-viewer-meta" class="text-xs uppercase tracking-[0.3em] text-slate-400"></p>
            </div>
            <div class="flex gap-2">
                <button id="story-viewer-prev" type="button" class="mobile-tap-target rounded-full border border-slate-700/70 px-4 py-2 text-xs text-slate-200 disabled:opacity-40">Previous</button>
                <button id="story-viewer-next" type="button" class="mobile-tap-target rounded-full border border-slate-700/70 px-4 py-2 text-xs text-slate-200 disabled:opacity-40">Next</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.UI.initFeedPage();
    });
</script>
{% endblock %}
